//minified using http://www.minifyjavascript.com/
var app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener('deviceready',this.onDeviceReady,false)},onDeviceReady:function(){app.receivedEvent('deviceready');app.startCardReader()},startCardReader:function(){if(typeof cardreader!="undefined"){var success=function(uid){if(localStorage.getItem("rsvp")=="true"||localStorage.getItem("enforcedeligibility")=="true"){CheckIn(uid,false,true)}else{SignIn(uid,true)}};var error=function(message){showCardReaderErrorAlert("Error: Please reswipe card")};cardreader.startCardReader(success,error)}},stopCardReader:function(){if(typeof cardreader!="undefined"){var success=function(){};var error=function(message){showCardReaderErrorAlert("Error: "+message)};cardreader.closeCardReader(success,error)}},receivedEvent:function(id){console.log('Received Event: '+id)}};function ClickBruincard(){console.log('Cancel click..');$('#div_logon').css('display','none');$('#div_signin_method').css('display','block');$('#div_bruincard').css('display','block');$('#div_header').removeClass('invisible');$('#div_header_cancel').addClass('invisible')}function ClickLogon(){$('#div_bruincard').css('display','none');$('#div_signin_method').css('display','none');$('#div_logon').css('display','block');$('#div_header').addClass('invisible');$('#div_header_cancel').removeClass('invisible');app.stopCardReader()}function SignInWithUclaLogon(){app.stopCardReader();SignIn($('#txt_logon').val())}var startTimer1;function SignIn(logon,isCardreader){isCardreader=typeof isCardreader!='undefined'?isCardreader:false;localStorage.setItem("cardswiped",isCardreader);var submitIntake=false;var qjson=JSON.parse(localStorage.getItem("questions"));if(qjson.HasQuestions==false){submitIntake=true}if(!isOfflineMode()){startTimer1=new Date().getTime();$.ajax({type:"GET",url:"http://sait-test.uclanet.ucla.edu/sawebnew2/api/validlogon",data:{"logon":logon,"submitIntake":submitIntake,"appkey":localStorage.getItem("key"),"initialintakestatus":localStorage.getItem("initialintakestatus"),"locationID":localStorage.getItem("selLocationID"),"cardSwiped":localStorage.getItem("cardswiped")},beforeSend:function(){app.stopCardReader();console.log('before send..');loading()},success:function(data){var jsonobj=JSON.parse(data);SetStudentData(jsonobj,submitIntake)},error:function(jqXHR,textStatus,errorThrown){ShowFlashMessage("Invalid UCLA logon");app.startCardReader()},complete:function(){$('body').removeClass('ajax-spinner')}})}else{var offlineData=GetOfflineStudentData();var jsonobj=JSON.parse(offlineData);SetStudentData(jsonobj,submitIntake)}}function SetStudentData(jsonobj,submitIntake){if(jsonobj.Data.IsValidLogon==true){localStorage.setItem("uid",jsonobj.Data.DictionaryUserInfo.UID);localStorage.setItem("firstname",jsonobj.Data.DictionaryUserInfo.FirstName)localStorage.setItem("lastname",jsonobj.Data.DictionaryUserInfo.LastName);localStorage.setItem("phone",jsonobj.Data.DictionaryUserInfo.Phone);localStorage.setItem("email",jsonobj.Data.DictionaryUserInfo.Email);if(!submitIntake){window.open("reasons.html","_self")}else{window.open("thankyou.html","_self")}}else{ShowFlashMessage("Error: Invalid logon");$('body').removeClass('ajax-spinner');$('div.ajax-spinner').removeClass('ajax-spinner');$('#txt_logon').focus();app.startCardReader()}}function OverrideCheckIn(){CheckIn(localStorage.getItem('uid'),true,localStorage.getItem('cardswiped'))}function CheckIn(logon,isoverride,isCardreader){isCardreader=typeof isCardreader!='undefined'?isCardreader:false;localStorage.setItem("cardswiped",isCardreader);var type=-1;if(localStorage.getItem("rsvp")=="true"){type=0}else if(localStorage.getItem("enforcedeligibility")){type=1}$.ajax({type:"GET",url:"http://sait-test.uclanet.ucla.edu/sawebnew2/api/checkineventuser",data:{"appid":localStorage.getItem("appid"),"uid":logon,"overrideRegistration":isoverride,"type":type,"initialintakestatus":localStorage.getItem("initialintakestatus"),"locationID":localStorage.getItem("selLocationID"),"appKey":localStorage.getItem("key"),"cardswiped":localStorage.getItem("cardswiped")},beforeSend:function(){app.stopCardReader();loading()},success:function(data){var jsonobj=JSON.parse(data);if(jsonobj.Data.UserInfo.IsValidLogon==false){ShowFlashMessage("Not valid logon")}else{localStorage.setItem("uid",jsonobj.Data.UserInfo.DictionaryUserInfo.UID);localStorage.setItem("firstname",jsonobj.Data.UserInfo.DictionaryUserInfo.FirstName)localStorage.setItem("lastname",jsonobj.Data.UserInfo.DictionaryUserInfo.LastName);localStorage.setItem("phone",jsonobj.Data.UserInfo.DictionaryUserInfo.Phone);localStorage.setItem("email",jsonobj.Data.UserInfo.DictionaryUserInfo.Email);$('#student_name').text(localStorage.getItem("firstname")+" "+localStorage.getItem("lastname"));if(jsonobj.Data.IsEligible==true){$('#success').removeClass('invisible');$('#failed').addClass('invisible')}else{$('#failed').removeClass('invisible');$('#success').addClass('invisible')}}app.startCardReader()},error:function(jqXHR,textStatus,errorThrown){ShowFlashMessage("Invalid UCLA logon");app.startCardReader()},complete:function(){endLoading()}})}function CloseApp(e){e.preventDefault();$("#dialog-modal").dialog({width:300,open:function(event,ui){},modal:true,dialogClass:"no-close",buttons:{"Cancel":function(){$(this).dialog("close")},"Submit":ValidateAppKey()},open:function(event){$('.ui-dialog-buttonpane').find('button:contains("Cancel")').addClass('modal-double-button-left');$('.ui-dialog-buttonpane').find('button:contains("Submit")').addClass('modal-double-button-right important')}})}function OverrideHelp(e){e.preventDefault();showNativeDialog("Selecting 'Override' marks the attendee as having been admitted but failed to meet the criteria set for this event.")}function ClickRegistration(){loading();app.stopCardReader();location.href='registration.html'}function ValidateAppKey(){var key=$("#txt_app_key").val();if(key==null||key==""){}else if(key==localStorage.getItem("key")){console.log('checking..');app.stopCardReader();localStorage.setItem("key","null");console.log('opening..');window.open("index.html","_self")}else{HideReconfigureLobbyDialog();ShowFlashMessage("Incorrect key")}}function NavigateToReasonsPage(){window.open('reasons.html','_self')}function HideReconfigureLobbyDialog(){$("#dialog-modal").kendoMobileModalView("close")}function ShowFlashMessage(message){$('#spanFlashMessage').text(message);$("#modalviewFlash").kendoMobileModalView("open");window.setTimeout(function(){$("#modalviewFlash").kendoMobileModalView("close")},1500)}function FailedCardSwipe(){$("#modalviewAlert").kendoMobileModalView("close");app.stopCardReader();window.open("login.html","_self")}function showCardReaderErrorAlert(msg){console.log(msg.toString);$('#spanAlertMessageCardReader').text(msg);$("#modalviewAlertCardReader").kendoMobileModalView("open")}var app1,initialView;function Initialize(){localStorage.setItem("CollectedResponses",JSON.stringify(""));if(localStorage.getItem("anon")!="true"){app.initialize()}InitForm();if(localStorage.getItem("allowregistration")=="false"){$("#btn-register").addClass("invisible")}app1=new kendo.mobile.Application(document.body,{useNativeScrolling:true,initial:initialView})};function ClickLogon(){app1.Navigate('#viewSigninWithUclaLogon');app.stopCardReader()}function InitForm(){$("#DeptName").text(localStorage.getItem("deptname"));if(localStorage.getItem("welcome")!=null&&localStorage.getItem("welcome")!="null"){$("#welcome_text").text(localStorage.getItem("welcome"));$("#welcome_text1").text(localStorage.getItem("welcome"))}if(localStorage.getItem("anon")=="true"){initialView="anon";$("#body").addClass("molecules-bg")}else if(localStorage.getItem("rsvp")=="true"||localStorage.getItem("enforcedeligibility")=="true"){initialView="rsvp_eleg";$("#body").removeClass("molecules-bg");$("#event_name").text(localStorage.getItem("appdescription"))}else{initialView="not_anon";$("#not_anon").removeClass("invisible");$('#txt_logon').val('').focus();$("#body").addClass("molecules-bg")}}